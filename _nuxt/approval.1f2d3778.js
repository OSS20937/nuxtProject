import{_ as F}from"./AppSelect.vue.b4c3b989.js";import{_ as M}from"./AppTextField.vue.b7e9490f.js";import{a as W,N as A,r as s,o as P,b as I,m as q,e as a,w as t,j as u,i,f as z,g as H,F as O,p as c}from"./entry.65ada128.js";import{b as T}from"./index.3b5a2c4c.js";import{u as N,w as G}from"./xlsx.f5126985.js";import{u as J}from"./emp.21d975f6.js";import{V as K,a as Q}from"./VTabs.c2b6e25d.js";import{a as d,b as w,V as X}from"./VCard.f486dae6.js";import{V as Y,a as Z}from"./VWindowItem.3ebdd740.js";import{V as U}from"./VRow.55c98ddb.js";import{V as y}from"./VCol.643afbff.js";import{V as ee}from"./VDataTable.40f54bb6.js";import{V as ae}from"./VContainer.ab27e81f.js";import{V as te}from"./VTextarea.01203149.js";import{V as le}from"./VDialog.93a74892.js";import"./VCheckboxBtn.bbe7695b.js";import"./forwardRefs.6ea3df5c.js";import"./VSelect.df16466a.js";import"./VMenu.85549b48.js";import"./createSimpleFunctional.89702091.js";import"./VAvatar.657122ee.js";import"./VDivider.dabdf568.js";/* empty css              */const oe={class:"text-center"},Te=W({__name:"approval",setup(re){const L=A(),f=J();f.loadEmpCode(),console.log("현재 로그인된 직원 코드:",f.empCode),f.empCode!=="EMP-01"&&f.empCode!=="EMP-00"&&L.push("/hr/confinement/unauthorized");const v=s("personal-info"),V=s(""),S=s([]),h=s([]),_=s(""),C=s(""),o=s([]),g=s(""),m=s(!1),D=s(""),k=s([]),$=[{title:"신청번호",key:"certificateNo"},{title:"신청일자",key:"requestDate"},{title:"사원명",key:"empName"},{title:"증명서구분",key:"category"},{title:"증명서용도",key:"usageName"},{title:"출력일자",key:"useDate"},{title:"승인상태",key:"approvalStatus"}];P(()=>{R()});const R=async()=>{await T().FETCH_DEPTLIST(),S.value=Object.values(T().deptList).map(r=>({title:r.deptName,value:r.deptName}))},b=async()=>{if(V.value===""||_.value===""||C.value===""){alert("모든 항목을 선택해주세요.");return}await c.get("http://localhost:8282/hr/certificate/findCertificateListByDept",{params:{startDate:_.value,endDate:C.value,deptName:V.value}}).then(r=>{h.value=r.data.certificateList,console.log("certificateList",h.value)}).catch(r=>console.error(r))},x=async r=>{if(o.value.length===0){alert("항목을 선택해주세요.");return}if(r==="승인"&&o.value[0].approvalStatus==="승인"){alert("이미 승인된 건입니다.");return}if(r==="승인취소"&&o.value[0].approvalStatus==="승인대기"){alert("승인대기건은 승인취소할 수 없습니다.");return}const e=r==="승인"?"approval":"cancel",p=r==="승인"?"승인 완료되었습니다.":"승인 취소 완료되었습니다.",n=o.value.map(l=>({...l,approvalStatus:e}));console.log("updatedRows",n);try{await c.post("http://localhost:8282/hr/certificate//approvalCertificateList",n),alert(p)}catch(l){console.error(l)}o.value=[],b()},j=()=>{var r;if(o.value.length===0){alert("항목을 선택해주세요.");return}if(((r=o.value[0])==null?void 0:r.approvalStatus)==="승인"){alert("승인된 건은 반려할 수 없습니다."),o.value=[];return}m.value=!0},E=async()=>{const r=o.value.map(e=>({...e,approvalStatus:"refer",rejectCause:D.value}));console.log("updatedRows",r),await c.post("http://localhost:8282/hr/certificate/approvalCertificateList",r),m.value=!1,alert("승인 반려 완료되었습니다. "),o.value=[],b()},B=async()=>{var r;if(o.value.length===0){alert("출력할 증명서를 선택해주세요.");return}if(o.value.length>1){alert("1개의 증명서만 선택해주세요.");return}if(o.value[0].approvalStatus!="승인"){alert("승인된 증명서만 출력가능합니다.");return}if(o.value[0].useDate!=null){alert("이미 출력된 건입니다.");return}g.value=(r=o.value[0])==null?void 0:r.certificateNo,console.log(g.value),await c.patch(`http://localhost:8282/hr/certificate/updateUseDate/${g.value}`).then(e=>{console.log("updateUseDate",e.data)}).catch(e=>console.error(e)),await c.get("http://localhost:8282/hr/certificate/printCertificate",{params:{certificateNo:g.value}}).then(e=>{k.value=e.data.printCertificate,console.log("printCertificate.value",k.value),console.log("selectedRows.value",o.value);const p=N.json_to_sheet([k.value]);console.log("certWS",p);const n=N.book_new();N.book_append_sheet(n,p,"certificate"),G(n,`${new Date}_${o.value[0].empName}_${o.value[0].category}.xlsx`)}).catch(e=>console.error(e)),o.value=[],b()};return(r,e)=>{const p=F,n=M;return I(),q(O,null,[a(d,null,{default:t(()=>[a(K,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),height:"70"},{default:t(()=>[a(Q,{value:"personal-info"},{default:t(()=>[u(" 증명서 관리 ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{flat:""},{default:t(()=>[a(w,null,{default:t(()=>[a(Y,{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=l=>v.value=l),class:"disable-tab-transition"},{default:t(()=>[a(Z,{value:"personal-info"},{default:t(()=>[a(d,{class:"mb-6"},{default:t(()=>[a(w,null,{default:t(()=>[a(U,null,{default:t(()=>[a(y,{cols:"12",sm:"3"},{default:t(()=>[a(p,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=l=>V.value=l),label:"부서명",items:S.value,clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),a(y,{cols:"12",sm:"3",mt:"4"},{default:t(()=>[a(n,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),type:"date",label:"시작일",placeholder:"시작일"},null,8,["modelValue"])]),_:1}),a(y,{cols:"12",sm:"3",mt:"4"},{default:t(()=>[a(n,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=l=>C.value=l),type:"date",label:"종료일",placeholder:"종료일"},null,8,["modelValue"])]),_:1}),a(i,{class:"mt-10",onClick:b},{default:t(()=>[u(" 조회 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(d,{class:"mt-6"},{default:t(()=>[a(w,{class:"mt-3 mb-3"},{default:t(()=>[u(" 증명서승인내역 ")]),_:1}),a(z(ee),{modelValue:o.value,"onUpdate:modelValue":e[5]||(e[5]=l=>o.value=l),headers:$,items:h.value,"items-per-page":10,"show-select":"","return-object":"","item-value":"certificateNo"},null,8,["modelValue","items"]),a(U,{class:"text-right mr-3 mb-2 mt-3"},{default:t(()=>[a(y,null,{default:t(()=>[a(i,{class:"mr-2",color:"primary",onClick:e[6]||(e[6]=l=>x("승인"))},{default:t(()=>[u(" 승인 ")]),_:1}),a(i,{class:"mr-2",color:"primary",onClick:e[7]||(e[7]=l=>x("승인취소"))},{default:t(()=>[u(" 승인취소 ")]),_:1}),a(i,{color:"primary",class:"mr-2",onClick:j},{default:t(()=>[u(" 승인반려 ")]),_:1}),a(i,{color:"primary",onClick:B},{default:t(()=>[u(" 출력 ")]),_:1})]),_:1})]),_:1})]),_:1}),H("div",oe,[a(le,{modelValue:m.value,"onUpdate:modelValue":e[10]||(e[10]=l=>m.value=l),width:"300"},{default:t(()=>[a(d,null,{default:t(()=>[a(w,null,{default:t(()=>[u(" 반려사유를 입력해주세요. ")]),_:1}),a(ae,null,{default:t(()=>[a(te,{modelValue:D.value,"onUpdate:modelValue":e[8]||(e[8]=l=>D.value=l),clearable:"",label:"반려사유",variant:"outlined"},null,8,["modelValue"])]),_:1}),a(X,null,{default:t(()=>[a(i,{color:"primary",onClick:E},{default:t(()=>[u(" 반려 ")]),_:1}),a(i,{color:"primary",onClick:e[9]||(e[9]=l=>m.value=!1)},{default:t(()=>[u(" 닫기 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])],64)}}});export{Te as default};
