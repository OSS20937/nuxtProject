import{h as T,d as P,a as j,N as q,r as u,x as F,b as H,m as O,e as s,w as n,i as g,j as L,f as $,F as M,g as z,aw as G}from"./entry.45328514.js";import{u as J}from"./emp.a7befc65.js";import{V as K}from"./VRow.2cb9c593.js";import{V as h}from"./VCol.41614dfd.js";import{V as x}from"./VCheckboxBtn.731da787.js";import{V as Q}from"./VSelect.370b9de8.js";import{V as W}from"./VDataTable.48cadc94.js";import{a as X}from"./VCard.aca4253c.js";import{V as Z}from"./VAlert.01de9f34.js";import{V as ee}from"./VSnackbar.dedb15a0.js";/* empty css              */import"./forwardRefs.6ea3df5c.js";import"./VMenu.7b9e0b3d.js";import"./createSimpleFunctional.05e807c5.js";import"./VAvatar.c7dee377.js";import"./VDivider.59e18b83.js";const k="/edu";function te(t){return console.log("payload",t),T.post(`${k}/approReqEdu`,t)}function ae(t){return console.log("payload",t),T.get(`${k}/searchEduListByStatus`,{params:t})}function oe(t){return T.delete(`${k}/removeEduList`,{params:{searchYear:t.searchYear,eduCode:t.eduCode,empCode:t.empCode,status:t.status}})}const se=P("eduStore",{state:()=>({eduList:[{deptName:"",durationOfTraining:"",empCode:"",empName:"",searchYear:"",status:""}],selEduList:[{eduCode:"",eduName:"",empCode:"",empName:"",deptCode:"",deptName:"",eduHistory:"",searchYear:"",status:""}]}),actions:{async APPRO_EDU_LIST(t){try{console.log("교육 승인요청중");const a=await te(t);return this.eduList=a.data.eduList,console.log("response.data",a.data),a.data}catch(a){throw new Error(a)}},async SEARCH_EDU_LIST_STATUS(t){try{console.log("교육 관리 승인여부 조회");const a=await ae(t);return this.selEduList=a.data,console.log("response",a.data),a.data}catch(a){throw new Error(a)}},async DELETE_EDU_LIST(t){try{return console.log("교육 관리 내역 삭제"),await oe(t)}catch(a){throw new Error(a)}}}}),le=z("h1",{class:"mb-6"},"📋 교육 관리 및 승인요청",-1),_e=j({__name:"manage",setup(t){const a=q(),f=J();f.loadEmpCode(),console.log("현재 로그인된 직원 코드:",f.empCode),f.empCode!=="EMP-0001"&&a.push("/hr/confinement/unauthorized");const v=se();u("");const E=u(""),w=u(""),y=u(""),r=u([]),D=u(null),V=u([]),R=[{title:"교육코드",key:"eduCode",width:100},{title:"교육명",key:"eduName",width:"150px"},{title:"직원코드",key:"empCode",width:120},{title:"직원명",key:"empName",width:100},{title:"부서코드",key:"deptCode",width:120},{title:"부서명",key:"deptName",width:120},{title:"교육 이수 내역",key:"eduHistory",width:"150px"},{title:"승인상태",key:"status",width:120},{title:"검색년도",key:"searchYear",width:"150px"}],U=[{title:"미승인",value:"신청완료"},{title:"승인요청",value:"승인요청"},{title:"반려",value:"승인반려"},{title:"승인완료",value:"승인완료"}],c=u(!1),i=u("success"),m=u("success"),p=u("완료되었습니다."),C=()=>{r.value=[]},_=async()=>{try{const d=y.value,e=E.value,o=w.value,l={sDate:e,eDate:o,status:d};console.log(l),await v.SEARCH_EDU_LIST_STATUS(l),V.value=Array.isArray(v.selEduList)?v.selEduList:[],console.log("조회 성공",V.value)}catch(d){throw new Error(d)}C()},b=async()=>{if(f.empCode!=="EMP-0001"){i.value="error",p.value="⛔ 권한이 없습니다. 관리자에게 문의해주세요.",m.value="error",c.value=!0;return}if(console.log("승인요청 실행",r.value),r.value.some(e=>e.status==="승인완료")){i.value="error",p.value="✅ 이미 승인완료된 항목입니다.",m.value="error",c.value=!0;return}for(const e of r.value){const{searchYear:o,eduCode:l}=e,S={searchYear:o,eduCode:l,status:"승인요청"};await v.APPRO_EDU_LIST(S)}_(),C()},A=async()=>{console.log("삭제실행",r.value);const d=r.value.some(l=>l.status==="승인완료"),e=r.value.some(l=>l.status==="승인요청"),o=r.value.some(l=>l.status==="반려");if(d){i.value="error",p.value="✅ 승인완료된 항목은 삭제할 수 없습니다.",m.value="error",c.value=!0;return}if(e){i.value="warning",p.value="⚠️ 승인요청 중인 항목은 삭제할 수 없습니다.",m.value="warning",c.value=!0;return}if(o){i.value="info",p.value="ℹ️ 승인반려 항목은 관리자 확인 후 삭제 가능합니다.",m.value="info",c.value=!0;return}try{for(const l of r.value){const{searchYear:S,eduCode:N,empCode:Y,status:B}=l,I={searchYear:S,eduCode:N,empCode:Y,status:B};await v.DELETE_EDU_LIST(I)}_(),await G(),C()}catch(l){console.error("삭제 중 오류 발생:",l.message)}};return F(r,d=>{console.log("[선택된 행]",d)}),(d,e)=>(H(),O(M,null,[le,s(X,{class:"pa-6"},{default:n(()=>[s(K,{class:"align-end mb-4"},{default:n(()=>[s(h,{cols:"12",sm:"3",mt:"4"},{default:n(()=>[s(x,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=o=>E.value=o),type:"date",label:"시작일",placeholder:"시작일",variant:"outlined",density:"compact",class:"compact-textfield"},null,8,["modelValue"])]),_:1}),s(h,{cols:"12",sm:"3",mt:"4"},{default:n(()=>[s(x,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),type:"date",label:"종료일",placeholder:"종료일",variant:"outlined",density:"compact",class:"compact-textfield"},null,8,["modelValue"])]),_:1}),s(h,{cols:"12",md:"2"},{default:n(()=>[s(Q,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=o=>y.value=o),label:"승인상태",items:U,variant:"outlined",density:"compact",class:"compact-textfield"},null,8,["modelValue"])]),_:1}),s(h,{cols:"12",class:"d-flex justify-end align-end"},{default:n(()=>[s(g,{class:"ma-1",color:"primary",onClick:_},{default:n(()=>[L(" 조회 ")]),_:1}),s(g,{class:"ma-1",color:"success",onClick:b},{default:n(()=>[L(" 승인요청 ")]),_:1}),s(g,{class:"ma-1",color:"error",onClick:A},{default:n(()=>[L(" 삭제 ")]),_:1})]),_:1})]),_:1}),s($(W),{ref_key:"dataTableRef",ref:D,modelValue:r.value,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value=o),class:"mt-8",headers:R,items:V.value,"items-per-page":10,"show-select":"","item-value":"eduCode","return-object":""},null,8,["modelValue","items"])]),_:1}),s(ee,{modelValue:c.value,"onUpdate:modelValue":e[4]||(e[4]=o=>c.value=o),location:"top",timeout:3e3,color:i.value},{default:n(()=>[s(Z,{density:"compact",type:m.value,title:"알림",text:p.value},null,8,["type","text"])]),_:1},8,["modelValue","color"])],64))}});export{_e as default};
